[TOC]

# C++事始め

すいません、準備中です m(_ _)m

## 本ページで触れる内容

言語要素としては以下のような内容について触れる予定です

- 型システム
  - 基本型(charやintやらの値型と呼ばれるもの)
  - 構造体・クラス型
- CからC++へ
  - クラスとは何なのか？
  - それが使えると何が嬉しいのか？

また、C++としては非常に強力かつ重要な要素なのですが、本ページでは敢えて触れないでおこうと考えているものがあります

- テンプレート
  - すなわちSTLは除外

    - 初学者がSTLを学ぶとエラーメッセージに困惑する事になります。例えば、以下のような初心者にありがちなコーディングミス

      ```cpp
      std::string s = hello world; // 文字列がダブルクォーテーション(")で括られていない!!
      ```

    - これに対するエラーメッセージはこうなります

      - E0415 "int" から "std::basic_string<char, std::char_traits<char>, std::allocator<char>>" に変換するための適切なコンストラクターが存在しません
      - C2440 '初期化中': 'int' から 'std::basic_string<char,std::char_traits<char>,std::allocator<char>>' に変換できません

  - リソース制約のある環境を扱うものとしています

    - [c++ テンプレート サイズ 肥大]辺りでググると解説があります
    - C++の応用範囲を著しく拡げてしまう為、先ずは蓋をしておきたい

- 例外
  - **例外をどういうポリシーで扱うか**？という設計の選択が発生します

    - 例えば前橋和弥氏が翻訳された[例外に関する議論例](http://d.hatena.ne.jp/kmaebashi/20100101/p1)辺りを見ると、熟練者であっても見解が統一されておらず、初学者にどう説明すべきか決められませんでした

  - リソースに余裕がなくRAIIが正しく活用されていない開発プロジェクトという想定の為

    - メモリリークが発生しうるサンプルです。
      - try/catchで例外を捕捉するか、一行目をコメント行のように置き換える必要があります

    ```cpp
    CHoge *h = new CHoge(); // std::shared_ptr< CHoge > h( new CHoge() );
    
    raise_exception_func(); // 例外が発生しうる関数
    
    delete h; // raise_exception_func()が例外を投げてしまうと、ここが実行されない
        
    ```

# C++のコードを見てみる

## 最初のコード。そして断念

**C++らしい入門コード**といえば、以下のようなものでしょうか

```cpp
#include <iostream>

int main( void )
{
    std::cout << "hello world!!" << std::endl;    
}
```

想定読者は**C言語をかじった人**なので、上のコードに含まれるC++っぽい部分に触れてみます。

- iostreamヘッダは、C++標準ライブラリiostreamの定義が入っている
- main()関数の返り値を省略する事が出来る(その場合return 0相当になる)
- std::coutは**「std名前空間(namespace)にあるcoutというオブジェクト」**
- <<は、演算子''<<''をオーバーロードしたもの

思った以上にC++っぽい要素が満載でした。 orz...

マトモな解説書では、詳細をボヤカしたり、真面目に説明したりするのでしょうが、

「取り敢えずC++言語をそれっぽく読めるようになればいい」

事が当面の目標なので、丸々スルーしてしまう事にします

## 少しハードルを下げた入門コード

気を取り直して、C++の入門コードを書いてみます

```cpp
#include <cstdio>

int main( void )
{
    printf( "hello world!!" );    
}
```

ほぼC言語のコードですね。「<stdio.h>ではなく<cstdio>」となっている点だけが異なります

## C言語からC++になった経緯

C言語によって幾つものUnix系OSが開発され、システムがリッチになるにつけ

- Lispみたいに潤沢なマシンパワーを利用してもいいんじゃない？
- smalltalkって言語で**オブジェクト指向**ってのが流行っているみたい

という時代の流れが生まれて、それをC言語にも取り込もうという流れが生まれました。C++設計者がこの辺りの話を書いてくれているので、

「C++の設計と進化」Bjarne Stroustrup

をご覧頂くのがお勧めです（大好きな書籍の一つです）

### はじめてのオブジェクト

では、早速オブジェクトを作ってみましょう。

```cpp
struct Hoge{
  int a;  
};
Hoge hoge;
```

すいません、わざと構造体で書いてみました。とはいえ、普通だとstruct Hogeの所を

```cpp
class Hoge{
public:
  int a;  
};
Hoge hoge;
```

としているだけなので敢えてこうしてみました。ご存知の方も多いと思いますが、

「構造体とクラスは、デフォルトのアクセシビリティがpublicかprivateの違いしかない」

ので、**C言語から移行される方に新しいキーワードなしでオブジェクトを示す**ならこれもアリかな、と

### クラス？オブジェクト？

C++を象徴するキーワードの「クラス」「オブジェクト」…この定義については、今まであらゆる説明が為されてきました。なので今まで私が解釈している感覚での説明でいくと

- クラスは定義
- オブジェクトは型定義を元に作られた変数

という風に覚えています。

```cpp
class Hoge{ // Hogeクラスの定義
public:
    int a;
};
Hoge a; // Hogeクラス型のaという変数を作る
```

## クラス基本機能の紹介

C++誕生の動機はクラスをC言語に取り込む事にあったと言っても過言ではありません。上で紹介した通り、クラス定義コードはC言語の構造体に似ています。しかし、それだけでは**言語仕様の総合デパート(私が勝手に付けました)**と呼ばれるクラスのほんの1割も紹介出来ていません。ここでは、初学者に伝えておきたい代表的な３つの要素を紹介しておきます。

### 関数を持てる

C言語には変数しか持たせる事が出来ませんでしたが、C++では関数を持たせる事が出来るようになりました。ただ、C言語でも構造体へ関数ポインタを持たせれば似せられる事が出来るので並べて紹介してみます

```c
// C言語版
typedef void ( *func_t )( void );
void say_hello( void ){ puts( "hello" ); }
typedef struct{
    int a;
    func_t func;
}Hoge_T;

int main()
{
    Hoge_T hoge;
    hoge.a = 100;
    hoge.func = say_hello;
    printf( "hoge.a is %d\n", hoge.a ); // hoge.a is 100
    hoge.func(); // say_hello()が呼ばれ、"hello"が出力される
    return 0;
}
```

```cpp
// C++版
class Hoge_T{
public:
    int a;
    void say_hello( void ){ puts( "hello" ); }
};

int main()
{
    Hoge_T hoge;
    hoge.a = 100;
    printf( "hoge.a is %d\n", hoge.a ); // hoge.a is 100
    hoge.func(); // Hoge_T::say_hello()が呼ばれ"hello"が出力される
}
```

コードがスッキリしてC++っぽさを感じられたが出たでしょうか？



### アクセシビリティ(アクセス制限)

作業中

### コンストラクタ(初期化)とデストラクタ(終了処理)

作業中

### 継承

作業中